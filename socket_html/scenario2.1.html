<!DOCTYPE html>
<html>
<head>
	<title>Client | Socket TCP</title>
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">

	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/data.js"></script>
	<script type="text/javascript" src="js/bootstrap.min.js"></script>
	<script type="text/javascript" src="js/jquery.imagemapster.min.js"></script>
	<script type="text/javascript" src="js/handlebars-v4.0.5.js"></script>
	<script type="text/javascript" src="js/lodash.min.js"></script>
	<script type="text/javascript" src="js/jquery.touchSwipe.min.js"></script>
	
	<link rel="stylesheet" href="css/bootstrap.min.css">
<!-- 	<link rel="stylesheet" href="css/style3.css"> -->
</head>
<body>

	<div class="container">
		<div class="row">
			<div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
			  <!-- Indicators -->
				<ol class="carousel-indicators">
					<li data-target="#carousel-example-generic" data-id="#001" data-slide-to="0" class="active"></li>
				    <li data-target="#carousel-example-generic" data-id="#002" data-slide-to="1"></li>
				</ol>

				  <!-- Wrapper for slides -->
				<div class="carousel-inner" role="listbox">
				    <div class="item active">
				    	<img src="images/salamanca.jpg">
				    </div>
				    <div class="item">
				    	<img src="images/cradleMt.jpg">
				    </div>
				</div>

				  <!-- Controls -->
				<a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
					<span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
				    <span class="sr-only">Previous</span>
				</a>
				<a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
					<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
					<span class="sr-only">Next</span>
				</a>
			</div>
		</div>
	</div>

	<script>

		// $(document).ready(function() {
		// 	var ws = new WebSocket("ws://10.217.26.58:8887/pos");
		// 	ws.onmessage = function receiveData (current) {

		// 		var list = ['current_product', 'forward_swipe', 'backward_swipe'];

		// 		var msgJSON = JSON.parse(current.data);

		// 		if(msgJSON['action'] == 'current_product') {
		// 			var product_id = msgJSON["product_id"];
		// 			var color = msgJSON["color"];
		// 		}
		// 		else if(msgJSON['action'] == 'forward_swipe') {
		// 			changeState('next');
		// 		}
		// 		else if(msgJSON['action'] == 'backward_swipe') {
		// 			changeState('prev')
		// 		}
		// 	}

		// 	function currentSelected() {
		// 		// var id = $('li.active').data('id');
		// 		// send_current_event(id);	
		// 		// console.log(id);
		// 		send_current_event(currentId);	
		// 	}

		// 	function send_current_event(currentId) {
		// 		var data = JSON.stringify({
		// 			"action": "current_selected",
		// 			"event_id": currentId
		// 		});
		// 		console.log(data);
		// 		ws.send(data);
		// 	}

		// 	$('.carousel').on('slide.bs.carousel', function() {
		// 	   currentId = $('.carousel').find('div.active').data('id');
		// 	   console.log(currentId);
		// 	});

		// 	$('.carousel').carousel('cycle');

		// 	// $('.carousel').on('slide.bs.carousel', function() {
		// 	//    currentId = $('.carousel').find('div.active').data('id');
		// 	//    console.log(currentId);
		// 	// });
		// });

		var ws = new WebSocket("ws://10.217.24.190:8887/pos");
		var carousel = $('.carousel');
		var currentState = 0;

		ws.onmessage = function receiveData (current) {

			// var list = ['current_product', 'forward_swipe', 'backward_swipe'];

			var msgJSON = JSON.parse(current.data);

			if(msgJSON['action'] == 'TiltDown') {
				jumpTo(getLastState());
				disableAutoSlide();
			}
			else if(msgJSON['action'] == 'forward_swipe') {
				changeState('next');
			}
			else if(msgJSON['action'] == 'backward_swipe') {
				changeState('prev');
			}else if(msgJSON['action'] == 'TiltUp') {
				keepLastState();
				getCurrentEvent();
				sendCurrentEvent()
				enableAutoSlide();
			}
		}

		function changeState(role) {
			$('.carousel').carousel(role);
			sendCurrentEvent();
		}

		function getCurrentEvent() {
			var currentId = $('li.active').data('id');
			return currentId;
			console.log(currentId);
		}

		function keepLastState() {
			currentState = $('li.active').data('slide-to');
		}

		function getLastState() {
			return currentState;
		}

		function sendCurrentEvent() {
			var currentEvent = getCurrentEvent();
			var data = JSON.stringify({
				"scenario": "2.1",
				"action": "current_event",
				"event_id": currentEvent
			});
			console.log(data);
			ws.send(data);
		}

		function disableAutoSlide() {
			carousel.carousel('pause');
			console.log('disable');
		}

		function enableAutoSlide() {
			carousel.carousel('cycle');
			console.log('enable');
		}

		function jumpTo(currentState) {
			carousel.carousel(currentState);
			console.log(currentState);
		}
		
		$(document).ready(function() {

		});

	</script>
</body>
</html>