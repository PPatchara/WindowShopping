<!DOCTYPE html>
<html>
<head>
	<title>Client | Socket TCP</title>
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">

<!-- 	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/data.js"></script>
	<script type="text/javascript" src="js/bootstrap.min.js"></script>
	<script type="text/javascript" src="js/jquery.imagemapster.min.js"></script>
	<script type="text/javascript" src="js/handlebars-v4.0.5.js"></script>
	<script type="text/javascript" src="js/lodash.min.js"></script>
	<script type="text/javascript" src="js/jquery.touchSwipe.min.js"></script> -->
	<script type="text/javascript" src="js/thumbnail-slider.js"></script>
	
<!-- 	<link rel="stylesheet" href="css/bootstrap.min.css"> -->
	<link rel="stylesheet" href="css/thumbs2.css">
	<link rel="stylesheet" href="css/thumbnail-slider.css">
</head>
<body>

<!-- 	<div class="container">
		<div class="row"> -->
<!-- 			<div id="carousel-example-generic" class="carousel slide" data-ride="carousel"> -->
			  <!-- Indicators -->
<!-- 				<ol class="carousel-indicators">
					<li data-target="#carousel-example-generic" data-id="#001" data-slide-to="0" class="active"></li>
				    <li data-target="#carousel-example-generic" data-id="#002" data-slide-to="1"></li>
				</ol> -->

				  <!-- Wrapper for slides -->
<!-- 				<div class="carousel-inner" role="listbox">
				    <div class="item active">
				    	<img src="images/salamanca.jpg">
				    </div>
				    <div class="item">
				    	<img src="images/cradleMt.jpg">
				    </div>
				</div> -->

				  <!-- Controls -->
<!-- 				<a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
					<span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
				    <span class="sr-only">Previous</span>
				</a>
				<a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
					<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
					<span class="sr-only">Next</span>
				</a> -->
<!-- 			</div> -->
<!-- 		</div>
	</div>-->

	    <!--start-->
    <div style="max-width:1500px; margin:0 auto;">

        <div style="float:left;">
            <div id="thumbnail-slider">
                <div class="inner">
                    <ul>
                        <li>
                            <a href="/">
                                <span class="thumb" style="background-image:url(img/1.jpg)">
                                </span>
                            </a>
                        </li>
                        <li>
                            <a class="thumb" href="img/2.jpg"></a>
                        </li>
                        <li>
                            <a class="thumb" href="img/3.jpg"></a>
                        </li>
                        <li>
                            <a class="thumb" href="img/4.jpg"></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div style="clear:both;"></div>

    </div>
    <!--end-->
	<script>

		// var ws = new WebSocket("ws://localhost:8887/pos");
		// var carousel = $('.carousel');
		// var currentState = 0;

		// ws.onmessage = function receiveData (current) {

		// 	// var list = ['current_product', 'forward_swipe', 'backward_swipe'];

		// 	var msgJSON = JSON.parse(current.data);

		// 	if(msgJSON['action'] == 'TiltDown') {
		// 		jumpTo(getLastState());
		// 		disableAutoSlide();
		// 	}
		// 	else if(msgJSON['action'] == 'forward_swipe') {
		// 		changeState('next');
		// 	}
		// 	else if(msgJSON['action'] == 'backward_swipe') {
		// 		changeState('prev');
		// 	}else if(msgJSON['action'] == 'TiltUp') {
		// 		keepLastState();
		// 		sendCurrentEvent();
		// 		enableAutoSlide();
		// 	}
		// }

		// ws.onopen = function(event) {
		// 	sendCurrentEvent();
		// }

		// function changeState(role) {
		// 	$('.carousel').carousel(role);
		// 	sendCurrentEvent();
		// }

		// function getCurrentEvent() {
		// 	var currentId = $('li.active').data('id');
		// 	return currentId;
		// 	console.log(currentId);
		// }

		// function keepLastState() {
		// 	currentState = $('li.active').data('slide-to');
		// }

		// function getLastState() {
		// 	return currentState;
		// }

		// function sendCurrentEvent() {
		// 	var currentEvent = getCurrentEvent();
		// 	var data = JSON.stringify({
		// 		"scenario": "2.1",
		// 		"action": "current_event",
		// 		"event_id": currentEvent
		// 	});
		// 	console.log(data);
		// 	ws.send(data);
		// }

		// function disableAutoSlide() {
		// 	carousel.carousel('pause');
		// 	console.log('disable');
		// }

		// function enableAutoSlide() {
		// 	carousel.carousel('cycle');
		// 	console.log('enable');
		// }

		// function jumpTo(currentState) {
		// 	carousel.carousel(currentState);
		// 	console.log(currentState);
		// }
		
		// $(document).ready(function() {

		// });

		var ws = new WebSocket("ws://localhost:8887/pos");
		var currentState = 0;
		var eventList = ["#001","#002","#003","#004"];

		ws.onmessage = function receiveData (current) {

			// var list = ['current_product', 'forward_swipe', 'backward_swipe'];

			var msgJSON = JSON.parse(current.data);

			if(msgJSON['action'] == 'TiltDown') {
				jumpTo(getLastState());
				disableAutoSlide();
			}
			else if(msgJSON['action'] == 'forward_swipe') {
				console.log('forward_swipe');
				mcThumbnailSlider.next();
			}
			else if(msgJSON['action'] == 'backward_swipe') {
				console.log('backward_swipe');
				mcThumbnailSlider.prev();
			}
			else if(msgJSON['action'] == 'TiltUp') {
				keepLastState();
				sendCurrentEvent();
				enableAutoSlide();
			}
		}

		ws.onopen = function(event) {
			sendCurrentEvent();
		}

		function changeState(role) {
			mcThumbnailSlider.next()
			sendCurrentEvent();
		}

		function getCurrentEvent() {
			var currentPos = mcThumbnailSlider.getPos();
			var currentId = eventList[currentPos];
			return currentId;
			console.log(currentId);
		}

		function keepLastState() {
			currentState = mcThumbnailSlider.getPos();
		}

		function getLastState() {
			return currentState;
		}

		function sendCurrentEvent() {
			var currentEvent = getCurrentEvent();
			var data = JSON.stringify({
				"scenario": "2.1",
				"action": "current_event",
				"event_id": currentEvent
			});
			console.log(data);
			ws.send(data);
		}

		function disableAutoSlide() {
			mcThumbnailSlider.toggle();
			console.log('disable');
		}

		function enableAutoSlide() {
			mcThumbnailSlider.toggle();
			console.log('enable');
		}

		function jumpTo(currentState) {
			mcThumbnailSlider.display(currentState);
			console.log(currentState);
		}

	</script>
</body>
</html>